<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: MockProxy

    &mdash; Documentation by YARD 0.9.5

</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "MockProxy";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">

    <a href="_index.html">Index (M)</a> &raquo;


    <span class="title">MockProxy</span>

</div>

        <div id="search">

    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>

</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="class_list.html"></iframe>

      <div id="content"><h1>Class: MockProxy



</h1>
<div class="box_info">

  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>

        <ul class="fullTree">
          <li>Object</li>

            <li class="next">MockProxy</li>

        </ul>
        <a href="#" class="inheritanceTree">show all</a>

    </dd>
  </dl>











  <dl>
    <dt>Defined in:</dt>
    <dd>lib/mock_proxy.rb<span class="defines">,<br />
  lib/mock_proxy/version.rb</span>
</dd>
  </dl>

</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">

<p>A non-opinionated proxy object that has multiple uses. It can be used for
mocking, spying, stubbing. Use as a dummy, double, fake, etc. Every test
double type possible. How? Let&#39;s see</p>

<p>Example, say you want to stub this scenario:
Model.new.generate_email.validate!.send(to: email) That would have be 5-6
lines of stubbing. If this sounds like stub_chain, you&#39;re on the right
track. It was removed in RSpec 3 (or 2?). It&#39;s similar to that but it
does things differently First, it doesn&#39;t require you to use it in a
stub Second, it&#39;s use of callbacks means you can define anything, a
stub or a mock (expectation) or a spy or whatever you want</p>

<p>To use MockProxy, initialize it with a hash. Each key is a method call.
Each call either returns a new proxy or calls the callback. If the value is
a callback, it calls it immediately with the args and block. If the value
is a hash, it returns a new proxy with the value as the hash. MockProxy
will warn if you don&#39;t use hashes or callbacks and will also warn if
you did not define all the method calls (it won&#39;t automatically return
itself for methods not defined in the hash)</p>

<p>Example use:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_let'>let</span><span class='lparen'>(</span><span class='symbol'>:model_proxy</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='const'>MockProxy</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>receive_email:</span> <span class='id identifier rubyid_callback'>callback</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>generate_email:</span> <span class='lbrace'>{</span> <span class='label'>validate!:</span> <span class='lbrace'>{</span> <span class='label'>send:</span> <span class='id identifier rubyid_callback'>callback</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_to'>to</span><span class='op'>|</span> <span class='id identifier rubyid_email'>email</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_before'>before</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_allow'>allow</span><span class='lparen'>(</span><span class='const'>Model</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'>receive</span><span class='lparen'>(</span><span class='symbol'>:new</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_and_return'>and_return</span> <span class='id identifier rubyid_model_proxy'>model_proxy</span> <span class='rbrace'>}</span>
<span class='comment'># ...
</span><span class='id identifier rubyid_describe'>describe</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Model</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>model also receives email</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='const'>MockProxy</span><span class='period'>.</span><span class='id identifier rubyid_observe'>observe</span><span class='lparen'>(</span><span class='id identifier rubyid_model_proxy'>model_proxy</span><span class='comma'>,</span> <span class='symbol'>:receive_email</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_message'>message</span><span class='op'>|</span>
      <span class='id identifier rubyid_expect'>expect</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_eq'>eq</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>message</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_run_system_under_test'>run_system_under_test</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>NOTE: You don&#39;t have to use only one mock proxy for all calls. You can
break it up if you want to have more control over each method call</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_let'>let</span><span class='lparen'>(</span><span class='symbol'>:model_proxy</span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_callback'>callback</span> <span class='op'>=</span> <span class='id identifier rubyid_callback'>callback</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_type'>type</span><span class='op'>|</span>
    <span class='const'>MockProxy</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_generator_proxy'>generator_proxy</span><span class='comma'>,</span> <span class='label'>decorate:</span> <span class='id identifier rubyid_callback'>callback</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span> <span class='id identifier rubyid_method_call'>method_call</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_generator_proxy'>generator_proxy</span>
  <span class='kw'>end</span>
  <span class='const'>MockProxy</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>generate_email:</span> <span class='id identifier rubyid_callback'>callback</span><span class='rparen'>)</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_let'>let</span><span class='lparen'>(</span><span class='symbol'>:generator_proxy</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='const'>MockProxy</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>validate!:</span> <span class='lbrace'>{</span> <span class='label'>send:</span> <span class='id identifier rubyid_callback'>callback</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_to'>to</span><span class='op'>|</span> <span class='id identifier rubyid_email'>email</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">

<p class="tag_title">Author:</p>
<ul class="author">

    <li>





        <div class='inline'>
<p>Geoff Lee</p>
</div>

    </li>

</ul>
<p class="tag_title">Since:</p>
<ul class="since">

    <li>





        <div class='inline'>
<p>0.1.0</p>
</div>

    </li>

</ul>

</div>
  <h2>Constant Summary</h2>
  <dl class="constants">

      <dt id="VERSION-constant" class="">VERSION =
        <div class="docstring">
  <div class="discussion">

<p>The version number</p>


  </div>
</div>
<div class="tags">

<p class="tag_title">Since:</p>
<ul class="since">

    <li>





        <div class='inline'>
<p>0.1.0</p>
</div>

    </li>

</ul>

</div>
      </dt>
      <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0.4.6</span><span class='tstring_end'>&#39;</span></span></pre></dd>

  </dl>








    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">

        <li class="public ">
  <span class="summary_signature">

      <a href="#get-class_method" title="get (class method)">.<strong>get</strong>(proxy, key_path)  &#x21d2; Block </a>



  </span>









    <span class="summary_desc"><div class='inline'>
<p>Retrieve the existing callback or callback tree at the specified key path.</p>
</div></span>

</li>


        <li class="public ">
  <span class="summary_signature">

      <a href="#merge-class_method" title="merge (class method)">.<strong>merge</strong>(proxy, new_callback_hash)  &#x21d2; MockProxy </a>



  </span>









    <span class="summary_desc"><div class='inline'>
<p>Deep merges the callback tree, replacing existing values with new values.</p>
</div></span>

</li>


        <li class="public ">
  <span class="summary_signature">

      <a href="#observe-class_method" title="observe (class method)">.<strong>observe</strong>(proxy, key_path) {|args| ... } &#x21d2; MockProxy </a>



  </span>









    <span class="summary_desc"><div class='inline'>
<p>Add an observer to an existing proxy.</p>
</div></span>

</li>


        <li class="public ">
  <span class="summary_signature">

      <a href="#replace_at-class_method" title="replace_at (class method)">.<strong>replace_at</strong>(proxy, key_path, &amp;block)  &#x21d2; MockProxy </a>



  </span>









    <span class="summary_desc"><div class='inline'>
<p>Replaces the callback at the specified key path, but only if there was one
there before.</p>
</div></span>

</li>


        <li class="public ">
  <span class="summary_signature">

      <a href="#set_at-class_method" title="set_at (class method)">.<strong>set_at</strong>(proxy, key_path, &amp;block)  &#x21d2; MockProxy </a>



  </span>









    <span class="summary_desc"><div class='inline'>
<p>Sets the callback at the specified key path, regardless if there was a
callback there before.</p>
</div></span>

</li>


        <li class="public ">
  <span class="summary_signature">

      <a href="#wrap-class_method" title="wrap (class method)">.<strong>wrap</strong>(proxy, key_path) {|args,| ... } &#x21d2; MockProxy </a>



  </span>









    <span class="summary_desc"><div class='inline'>
<p>Wraps the existing callback with your block.</p>
</div></span>

</li>


    </ul>

    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">

        <li class="public ">
  <span class="summary_signature">

      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(callback_hash = {})  &#x21d2; MockProxy </a>



  </span>


    <span class="note title constructor">constructor</span>








    <span class="summary_desc"><div class='inline'>
<p>A new instance of MockProxy.</p>
</div></span>

</li>


        <li class="public ">
  <span class="summary_signature">

      <a href="#method_missing-instance_method" title="#method_missing (instance method)">#<strong>method_missing</strong>(name, *args, &amp;block)  &#x21d2; Object </a>



  </span>









    <span class="summary_desc"><div class='inline'></div></span>

</li>


        <li class="public ">
  <span class="summary_signature">

      <a href="#respond_to%3F-instance_method" title="#respond_to? (instance method)">#<strong>respond_to?</strong>(m, allow_private = false)  &#x21d2; Boolean </a>



  </span>









    <span class="summary_desc"><div class='inline'></div></span>

</li>


    </ul>


<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>

    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">

    #<strong>initialize</strong>(callback_hash = {})  &#x21d2; <tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>





</h3><div class="docstring">
  <div class="discussion">

<p>Returns a new instance of MockProxy</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">

    <li>

        <span class='name'>callback_hash</span>


        <span class='type'>(<tt>Hash</tt>)</span>


        <em class="default">(defaults to: <tt>{}</tt>)</em>


        &mdash;
        <div class='inline'>
<p>the tree of chained method calls</p>
</div>

    </li>

</ul>

<p class="tag_title">Since:</p>
<ul class="since">

    <li>





        <div class='inline'>
<p>0.1.0</p>
</div>

    </li>

</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


262
263
264
265
266
267</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mock_proxy.rb', line 262</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_callback_hash'>callback_hash</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='symbol'>:valid_callback_tree?</span><span class='comma'>,</span> <span class='id identifier rubyid_callback_hash'>callback_hash</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not a valid callback tree: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_callback_hash'>callback_hash</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='ivar'>@callback_hash</span> <span class='op'>=</span> <span class='id identifier rubyid_callback_hash'>callback_hash</span><span class='period'>.</span><span class='id identifier rubyid_deep_stringify_keys'>deep_stringify_keys</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>

</div>
<div id="method_missing_details" class="method_details_list">
  <h2>Dynamic Method Handling</h2>
  <p class="notice this">
    This class handles dynamic methods through the <tt>method_missing</tt> method

  </p>

    <div class="method_details first">
  <h3 class="signature first" id="method_missing-instance_method">

    #<strong>method_missing</strong>(name, *args, &amp;block)  &#x21d2; <tt>Object</tt>





</h3><div class="docstring">
  <div class="discussion">


  </div>
</div>
<div class="tags">

<p class="tag_title">Since:</p>
<ul class="since">

    <li>





        <div class='inline'>
<p>0.1.0</p>
</div>

    </li>

</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mock_proxy.rb', line 270</span>

<span class='kw'>def</span> <span class='id identifier rubyid_method_missing'>method_missing</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_current'>current</span> <span class='op'>=</span> <span class='ivar'>@callback_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>MockProxy</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_current'>current</span>
    <span class='comment'># Proc-like
</span>  <span class='kw'>elsif</span> <span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:call</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='comment'># Hash-like
</span>  <span class='kw'>elsif</span> <span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:to_h</span><span class='rparen'>)</span>
    <span class='const'>MockProxy</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_current'>current</span><span class='rparen'>)</span>
    <span class='comment'># Value
</span>  <span class='kw'>elsif</span> <span class='id identifier rubyid_current'>current</span>
    <span class='id identifier rubyid_current'>current</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_fail'>fail</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Missing method </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>. Please add this definition to your mock proxy</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>

</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>


      <div class="method_details first">
  <h3 class="signature first" id="get-class_method">

    .<strong>get</strong>(proxy, key_path)  &#x21d2; <tt>Block</tt>





</h3><div class="docstring">
  <div class="discussion">

<p>Retrieve the existing callback or callback tree at the specified key path</p>

<p>NOTE: We freeze the hash so you cannot modify it</p>

<p>Use case: Retrieve callback to mock</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">

    <li>

        <span class='name'>proxy</span>


        <span class='type'>(<tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>)</span>



        &mdash;
        <div class='inline'>
<p>existing proxy</p>
</div>

    </li>

    <li>

        <span class='name'>key_path</span>


        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>, <tt>#to_s</tt>, <tt>Array&lt;String, Symbol, #to_s&gt;</tt>)</span>



        &mdash;
        <div class='inline'>
<p>the chain of methods or key path. Can be a dot delimited key path or an
array of method names as strings or symbols</p>
</div>

    </li>

</ul>

<p class="tag_title">Returns:</p>
<ul class="return">

    <li>


        <span class='type'>(<tt>Block</tt>)</span>



    </li>

</ul>
<p class="tag_title">Since:</p>
<ul class="since">

    <li>





        <div class='inline'>
<p>0.1.0</p>
</div>

    </li>

</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mock_proxy.rb', line 60</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_key_path'>key_path</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_get_and_validate_callback'>get_and_validate_callback</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_key_path'>key_path</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>

      <div class="method_details ">
  <h3 class="signature " id="merge-class_method">

    .<strong>merge</strong>(proxy, new_callback_hash)  &#x21d2; <tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>





</h3><div class="docstring">
  <div class="discussion">

<p>Deep merges the callback tree, replacing existing values with new values.
Avoid using this method for one method change; prefer replace_at. It has
clearer intent and less chances to mess up. MockProxy.merge uses deep_merge
under the hood and can have unexpected behaviour. It also does not type
check. Use at risk</p>

<p>Use case: Reuse existing stub but with some different values</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">

    <li>

        <span class='name'>proxy</span>


        <span class='type'>(<tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>)</span>



        &mdash;
        <div class='inline'>
<p>existing proxy</p>
</div>

    </li>

    <li>

        <span class='name'>new_callback_hash</span>


        <span class='type'>(<tt>Hash</tt>)</span>



        &mdash;
        <div class='inline'>
<p>new partial callback tree</p>
</div>

    </li>

</ul>

<p class="tag_title">Returns:</p>
<ul class="return">

    <li>


        <span class='type'>(<tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>)</span>



        &mdash;
        <div class='inline'>
<p>the original proxy object</p>
</div>

    </li>

</ul>
<p class="tag_title">Since:</p>
<ul class="since">

    <li>





        <div class='inline'>
<p>0.1.0</p>
</div>

    </li>

</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76
77
78
79
80</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mock_proxy.rb', line 74</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_new_callback_hash'>new_callback_hash</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_existing_callback_hash'>existing_callback_hash</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_get'>instance_variable_get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>@callback_hash</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new_callback_hash'>new_callback_hash</span> <span class='op'>=</span> <span class='id identifier rubyid_new_callback_hash'>new_callback_hash</span><span class='period'>.</span><span class='id identifier rubyid_deep_stringify_keys'>deep_stringify_keys</span>
  <span class='id identifier rubyid_new_callback_hash'>new_callback_hash</span> <span class='op'>=</span> <span class='id identifier rubyid_existing_callback_hash'>existing_callback_hash</span><span class='period'>.</span><span class='id identifier rubyid_deep_merge'>deep_merge</span><span class='lparen'>(</span><span class='id identifier rubyid_new_callback_hash'>new_callback_hash</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
  <span class='id identifier rubyid_proxy'>proxy</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>@callback_hash</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_callback_hash'>new_callback_hash</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_proxy'>proxy</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>

      <div class="method_details ">
  <h3 class="signature " id="observe-class_method">

    .<strong>observe</strong>(proxy, key_path) {|args| ... } &#x21d2; <tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>





</h3><div class="docstring">
  <div class="discussion">

<p>Add an observer to an existing proxy</p>

<p>Use case: Observe method call without changing the existing callback&#39;s
stubbed return value</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">

    <li>

        <span class='name'>proxy</span>


        <span class='type'>(<tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>)</span>



        &mdash;
        <div class='inline'>
<p>existing proxy</p>
</div>

    </li>

    <li>

        <span class='name'>key_path</span>


        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>, <tt>#to_s</tt>, <tt>Array&lt;String, Symbol, #to_s&gt;</tt>)</span>



        &mdash;
        <div class='inline'>
<p>the chain of methods or key path. Can be a dot delimited key path or an
array of method names as strings or symbols</p>
</div>

    </li>

</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">

    <li>

        <span class='name'>args</span>


        <span class='type'>(<tt>*args</tt>)</span>



    </li>

</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">

    <li>


        <span class='type'>(<tt>optional</tt>)</span>



    </li>

</ul>
<p class="tag_title">Returns:</p>
<ul class="return">

    <li>


        <span class='type'>(<tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>)</span>



        &mdash;
        <div class='inline'>
<p>the original proxy object</p>
</div>

    </li>

</ul>
<p class="tag_title">Since:</p>
<ul class="since">

    <li>





        <div class='inline'>
<p>0.1.0</p>
</div>

    </li>

</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


122
123
124
125
126
127
128
129
130
131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mock_proxy.rb', line 122</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_observe'>observe</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_key_path'>key_path</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_callback'>callback</span> <span class='op'>=</span> <span class='id identifier rubyid_get_and_validate_callback'>get_and_validate_callback</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_key_path'>key_path</span><span class='rparen'>)</span>
  <span class='comment'># Wrap existing callback, calling the provided block before it
</span>  <span class='comment'># Multiple calls to .observe will create a pyramid of callbacks, calling the observers before
</span>  <span class='comment'># eventually calling the existing callback
</span>  <span class='id identifier rubyid_new_callback'>new_callback</span> <span class='op'>=</span> <span class='id identifier rubyid_callback'>callback</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
    <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_callback'>callback</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_set_callback'>set_callback</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_key_path'>key_path</span><span class='comma'>,</span> <span class='id identifier rubyid_new_callback'>new_callback</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_proxy'>proxy</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>

      <div class="method_details ">
  <h3 class="signature " id="replace_at-class_method">

    .<strong>replace_at</strong>(proxy, key_path, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>





</h3><div class="docstring">
  <div class="discussion">

<p>Replaces the callback at the specified key path, but only if there was one
there before. Without creating new paths comes validation, including
checking that this replaces an existing callback, sort of like mkdir
(without the -p option)</p>

<p>Use case: Replace existing stub with a new callback without creating new
method chains</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">

    <li>

        <span class='name'>proxy</span>


        <span class='type'>(<tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>)</span>



        &mdash;
        <div class='inline'>
<p>existing proxy</p>
</div>

    </li>

    <li>

        <span class='name'>key_path</span>


        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>, <tt>#to_s</tt>, <tt>Array&lt;String, Symbol, #to_s&gt;</tt>)</span>



        &mdash;
        <div class='inline'>
<p>the chain of methods or key path. Can be a dot delimited key path or an
array of method names as strings or symbols</p>
</div>

    </li>

</ul>

<p class="tag_title">Returns:</p>
<ul class="return">

    <li>


        <span class='type'>(<tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>)</span>



        &mdash;
        <div class='inline'>
<p>the original proxy object</p>
</div>

    </li>

</ul>
<p class="tag_title">Since:</p>
<ul class="since">

    <li>





        <div class='inline'>
<p>0.1.0</p>
</div>

    </li>

</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mock_proxy.rb', line 92</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_replace_at'>replace_at</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_key_path'>key_path</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_set_callback'>set_callback</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_key_path'>key_path</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_proxy'>proxy</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>

      <div class="method_details ">
  <h3 class="signature " id="set_at-class_method">

    .<strong>set_at</strong>(proxy, key_path, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>





</h3><div class="docstring">
  <div class="discussion">

<p>Sets the callback at the specified key path, regardless if there was a
callback there before. No validation comes with automatic path creation,
meaning the key path will be defined it it hasn&#39;t already, sort of like
mkdir -p</p>

<p>Use case: Sets a new stub at specified key path while creating new method
chains</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">

    <li>

        <span class='name'>proxy</span>


        <span class='type'>(<tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>)</span>



        &mdash;
        <div class='inline'>
<p>existing proxy</p>
</div>

    </li>

    <li>

        <span class='name'>key_path</span>


        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>, <tt>#to_s</tt>, <tt>Array&lt;String, Symbol, #to_s&gt;</tt>)</span>



        &mdash;
        <div class='inline'>
<p>the chain of methods or key path. Can be a dot delimited key path or an
array of method names as strings or symbols</p>
</div>

    </li>

</ul>

<p class="tag_title">Returns:</p>
<ul class="return">

    <li>


        <span class='type'>(<tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>)</span>



        &mdash;
        <div class='inline'>
<p>the original proxy object</p>
</div>

    </li>

</ul>
<p class="tag_title">Since:</p>
<ul class="since">

    <li>





        <div class='inline'>
<p>0.1.0</p>
</div>

    </li>

</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mock_proxy.rb', line 107</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_at'>set_at</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_key_path'>key_path</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_set_callback'>set_callback</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_key_path'>key_path</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_proxy'>proxy</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>

      <div class="method_details ">
  <h3 class="signature " id="wrap-class_method">

    .<strong>wrap</strong>(proxy, key_path) {|args,| ... } &#x21d2; <tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>





</h3><div class="docstring">
  <div class="discussion">

<p>Wraps the existing callback with your block</p>

<p>Use case: Get full control of the existing callback while running custom
code</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">

    <li>

        <span class='name'>proxy</span>


        <span class='type'>(<tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>)</span>



        &mdash;
        <div class='inline'>
<p>existing proxy</p>
</div>

    </li>

    <li>

        <span class='name'>key_path</span>


        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>, <tt>#to_s</tt>, <tt>Array&lt;String, Symbol, #to_s&gt;</tt>)</span>



        &mdash;
        <div class='inline'>
<p>the chain of methods or key path. Can be a dot delimited key path or an
array of method names as strings or symbols</p>
</div>

    </li>

</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">

    <li>

        <span class='name'>args,</span>


        <span class='type'>(<tt>*args</tt>, <tt>&block</tt>)</span>



        &mdash;
        <div class='inline'>
<p>original callback</p>
</div>

    </li>

</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">

    <li>


        <span class='type'>(<tt>optional</tt>)</span>



    </li>

</ul>
<p class="tag_title">Returns:</p>
<ul class="return">

    <li>


        <span class='type'>(<tt><span class='object_link'><a href="" title="MockProxy (class)">MockProxy</a></span></tt>)</span>



        &mdash;
        <div class='inline'>
<p>the original proxy object</p>
</div>

    </li>

</ul>
<p class="tag_title">Since:</p>
<ul class="since">

    <li>





        <div class='inline'>
<p>0.1.0</p>
</div>

    </li>

</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


145
146
147
148
149
150
151
152
153
154
155</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mock_proxy.rb', line 145</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_wrap'>wrap</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_key_path'>key_path</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_callback'>callback</span> <span class='op'>=</span> <span class='id identifier rubyid_get_and_validate_callback'>get_and_validate_callback</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_key_path'>key_path</span><span class='rparen'>)</span>
  <span class='comment'># Wrap existing callback, calling the provided block before it
</span>  <span class='comment'># Multiple calls to .observe will create a pyramid of callbacks, calling the observers before
</span>  <span class='comment'># eventually calling the existing callback
</span>  <span class='id identifier rubyid_new_callback'>new_callback</span> <span class='op'>=</span> <span class='id identifier rubyid_callback'>callback</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
    <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_callback'>callback</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_set_callback'>set_callback</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_key_path'>key_path</span><span class='comma'>,</span> <span class='id identifier rubyid_new_callback'>new_callback</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_proxy'>proxy</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>

  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>


      <div class="method_details first">
  <h3 class="signature first" id="respond_to?-instance_method">

    #<strong>respond_to?</strong>(m, allow_private = false)  &#x21d2; <tt>Boolean</tt>





</h3><div class="docstring">
  <div class="discussion">


  </div>
</div>
<div class="tags">

<p class="tag_title">Returns:</p>
<ul class="return">

    <li>


        <span class='type'>(<tt>Boolean</tt>)</span>



    </li>

</ul>
<p class="tag_title">Since:</p>
<ul class="since">

    <li>





        <div class='inline'>
<p>0.1.0</p>
</div>

    </li>

</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


288
289
290</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mock_proxy.rb', line 288</span>

<span class='kw'>def</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span> <span class='id identifier rubyid_allow_private'>allow_private</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='ivar'>@callback_hash</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>

  </div>

</div>

      <div id="footer">
  Generated on Fri Oct 14 16:56:45 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.5 (ruby-2.2.2).
</div>

    </div>
  </body>
</html>